(this.webpackJsonpzims_react=this.webpackJsonpzims_react||[]).push([[0],{34:function(e,r,t){e.exports=t(44)},39:function(e,r,t){},44:function(e,r,t){"use strict";t.r(r);var n=t(16),o=t(20),a=t(21),i=t(23),s=t(22),d=t(0),c=t.n(d),l=t(11),u=t.n(l),f=(t(39),t(62)),v=t(59),g=t(61),m=t(60),p=t(7),h=t(31);S.sessions={},S.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),r=33;return window.navigator.userAgent.match("Linux")&&(r=35),e>=26&&e<=r||S.extension.isInstalled()}return!0};var b={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var r=window.setTimeout((function(){var r=new Error("NavigatorUserMediaError");return r.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(r)}),1e3);this.cache[r]=e,window.postMessage({type:"janusGetScreen",id:r},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(r){if(r.origin===window.location.origin)if("janusGotScreen"===r.data.type&&e[r.data.id]){var t=e[r.data.id];if(delete e[r.data.id],""===r.data.sourceId){var n=new Error("NavigatorUserMediaError");n.name="You cancelled the request for permission, giving up...",t(n)}else t(null,r.data.sourceId)}else"janusGetScreenPending"===r.data.type&&(console.log("clearing ",r.data.id),window.clearTimeout(r.data.id))}))}};function S(e){if((e=e||{}).success="function"==typeof e.success?e.success:S.noop,e.error="function"==typeof e.error?e.error:S.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:S.noop,!S.initDone)return e.error("Library not initialized"),{};if(!S.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(S.log("Library initialized: "+S.initDone),!e.server)return e.error("Invalid server url"),{};var r=!1,t=null,n={},o=null,a=null,i=0,s="/janusbase/janus";S.isArray(s)?(S.log("Multiple servers provided ("+s.length+"), will use the first that works"),s=null,a=e.server,S.debug(a)):0===s.indexOf("ws")?(r=!0,S.log("Using WebSockets to contact Janus: "+s)):(r=!1,S.log("Using REST API to contact Janus: "+s));var d=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],c=e.iceTransportPolicy,l=e.bundlePolicy,u=!0===e.ipv6,f=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(f=!0===e.withCredentials);var v=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(v=e.max_poll_events),v<1&&(v=1);var g=null;void 0!==e.token&&null!==e.token&&(g=e.token);var m=null;void 0!==e.apisecret&&null!==e.apisecret&&(m=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var h=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(h=e.keepAlivePeriod),isNaN(h)&&(h=25e3);var b=6e4;function w(e){var r={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(r.high=e.high),e.medium&&(r.medium=e.medium),e.low&&(r.low=e.low)),r}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(b=e.longPollTimeout),isNaN(b)&&(b=6e4);var y=!1,k=null,T={},A=this,C=0,D={};function R(){if(null!=k)if(S.debug("Long poll..."),y){var r=s+"/"+k+"?rid="+(new Date).getTime();v&&(r=r+"&maxev="+v),g&&(r=r+"&token="+encodeURIComponent(g)),m&&(r=r+"&apisecret="+encodeURIComponent(m)),S.httpAPICall(r,{verb:"GET",withCredentials:f,success:I,timeout:b,error:function(r,t){if(S.error(r+":",t),++C>3)return y=!1,void e.error("Lost connection to the server (is it down?)");R()}})}else S.warn("Is the server down? (connected=false)")}function I(e,n){if(C=0,r||void 0===k||null===k||!0===n||R(),r||!S.isArray(e))if("keepalive"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){var o=e.sender;if(!o)return void S.warn("Missing sender...");var a=T[o];if(!a)return void S.debug("This handle is not attached to this session");var i=e.candidate;S.debug("Got a trickled candidate on session "+k),S.debug(i);var s=a.webrtcStuff;s.pc&&s.remoteSdp?(S.debug("Adding remote candidate:",i),i&&!0!==i.completed?s.pc.addIceCandidate(i):s.pc.addIceCandidate(S.endOfCandidates)):(S.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),s.candidates||(s.candidates=[]),s.candidates.push(i),S.debug(s.candidates))}else{if("webrtcup"===e.janus){S.debug("Got a webrtcup event on session "+k),S.debug(e);var d=e.sender;if(!d)return void S.warn("Missing sender...");var c=T[d];return c?void c.webrtcState(!0):void S.debug("This handle is not attached to this session")}if("hangup"===e.janus){S.debug("Got a hangup event on session "+k),S.debug(e);var l=e.sender;if(!l)return void S.warn("Missing sender...");var u=T[l];if(!u)return void S.debug("This handle is not attached to this session");u.webrtcState(!1,e.reason),u.hangup()}else if("detached"===e.janus){S.debug("Got a detached event on session "+k),S.debug(e);var f=e.sender;if(!f)return void S.warn("Missing sender...");var v=T[f];if(!v)return;v.detached=!0,v.ondetached(),v.detach()}else if("media"===e.janus){S.debug("Got a media event on session "+k),S.debug(e);var g=e.sender;if(!g)return void S.warn("Missing sender...");var m=T[g];if(!m)return void S.debug("This handle is not attached to this session");m.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){S.debug("Got a slowlink event on session "+k),S.debug(e);var p=e.sender;if(!p)return void S.warn("Missing sender...");var h=T[p];if(!h)return void S.debug("This handle is not attached to this session");h.slowLink(e.uplink,e.lost)}else{if("error"===e.janus){S.error("Ooops: "+e.error.code+" "+e.error.reason),S.debug(e);var b=e.transaction;if(b){var w=D[b];w&&w(e),delete D[b]}return}if("event"===e.janus){S.debug("Got a plugin event on session "+k),S.debug(e);var y=e.sender;if(!y)return void S.warn("Missing sender...");var A=e.plugindata;if(!A)return void S.warn("Missing plugindata...");S.debug("  -- Event is coming from "+y+" ("+A.plugin+")");var O=A.data;S.debug(O);var j=T[y];if(!j)return void S.warn("This handle is not attached to this session");var V=e.jsep;V&&(S.debug("Handling SDP as well..."),S.debug(V));var M=j.onmessage;M?(S.debug("Notifying application..."),M(O,V)):S.debug("No provided notification callback")}else{if("timeout"===e.janus)return S.error("Timeout on session "+k),S.debug(e),void(r&&t.close(3504,"Gateway timeout"));S.warn("Unknown message/event  '"+e.janus+"' on session "+k),S.debug(e)}}}else{S.debug("Got a success on session "+k),S.debug(e);var P=e.transaction;if(P){var E=D[P];E&&E(e),delete D[P]}}else{S.debug("Got an ack on session "+k),S.debug(e);var x=e.transaction;if(x){var L=D[x];L&&L(e),delete D[x]}}else S.vdebug("Got a keepalive on session "+k);else for(var F=0;F<e.length;F++)I(e[F],!0)}function O(){if(s&&r&&y){o=setTimeout(O,h);var e={janus:"keepalive",session_id:k,transaction:S.randomString(12)};g&&(e.token=g),m&&(e.apisecret=m),t.send(JSON.stringify(e))}}function j(d){var c=S.randomString(12),l={janus:"create",transaction:c};if(d.reconnect&&(y=!1,l.janus="claim",l.session_id=k,t&&(t.onopen=null,t.onerror=null,t.onclose=null,o&&(clearTimeout(o),o=null))),g&&(l.token=g),m&&(l.apisecret=m),!s&&S.isArray(a)&&(0===(s=a[i]).indexOf("ws")?(r=!0,S.log("Server #"+(i+1)+": trying WebSockets to contact Janus ("+s+")")):(r=!1,S.log("Server #"+(i+1)+": trying REST API to contact Janus ("+s+")"))),r)for(var u in t=S.newWebSocket(s,"janus-protocol"),n={error:function(){if(S.error("Error connecting to the Janus WebSockets server... "+s),S.isArray(a)&&!d.reconnect)return++i===a.length?void d.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){j(d)}),200));d.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){D[c]=function(e){if(S.debug(e),"success"!==e.janus)return S.error("Ooops: "+e.error.code+" "+e.error.reason),void d.error(e.error.reason);o=setTimeout(O,h),y=!0,k=e.session_id?e.session_id:e.data.id,d.reconnect?S.log("Claimed session: "+k):S.log("Created session: "+k),S.sessions[k]=A,d.success()},t.send(JSON.stringify(l))},message:function(e){I(JSON.parse(e.data))},close:function(){s&&y&&(y=!1,e.error("Lost connection to the server (is it down?)"))}})t.addEventListener(u,n[u]);else S.httpAPICall(s,{verb:"POST",withCredentials:f,body:l,success:function(e){if(S.debug(e),"success"!==e.janus)return S.error("Ooops: "+e.error.code+" "+e.error.reason),void d.error(e.error.reason);y=!0,k=e.session_id?e.session_id:e.data.id,d.reconnect?S.log("Claimed session: "+k):S.log("Created session: "+k),S.sessions[k]=A,R(),d.success()},error:function(e,r){if(S.error(e+":",r),S.isArray(a)&&!d.reconnect)return++i===a.length?void d.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){j(d)}),200));""===r?d.error(e+": Is the server down?"):d.error(e+": "+r)}})}function V(e,n){if((n=n||{}).success="function"==typeof n.success?n.success:S.noop,n.error="function"==typeof n.error?n.error:S.noop,!y)return S.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var o=T[e];if(!o||!o.webrtcStuff)return S.warn("Invalid handle"),void n.error("Invalid handle");var a=n.message,i=n.jsep,d=S.randomString(12),c={janus:"message",body:a,transaction:d};if(o.token&&(c.token=o.token),m&&(c.apisecret=m),i&&(c.jsep={type:i.type,sdp:i.sdp},i.e2ee&&(c.jsep.e2ee=!0)),S.debug("Sending message to plugin (handle="+e+"):"),S.debug(c),r)return c.session_id=k,c.handle_id=e,D[d]=function(e){if(S.debug("Message sent!"),S.debug(e),"success"===e.janus){var r=e.plugindata;if(!r)return S.warn("Request succeeded, but missing plugindata..."),void n.success();S.log("Synchronous transaction successful ("+r.plugin+")");var t=r.data;return S.debug(t),void n.success(t)}"ack"===e.janus?n.success():e.error?(S.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(S.error("Unknown error"),n.error("Unknown error"))},void t.send(JSON.stringify(c));S.httpAPICall(s+"/"+k+"/"+e,{verb:"POST",withCredentials:f,body:c,success:function(e){if(S.debug("Message sent!"),S.debug(e),"success"===e.janus){var r=e.plugindata;if(!r)return S.warn("Request succeeded, but missing plugindata..."),void n.success();S.log("Synchronous transaction successful ("+r.plugin+")");var t=r.data;return S.debug(t),void n.success(t)}"ack"===e.janus?n.success():e.error?(S.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(S.error("Unknown error"),n.error("Unknown error"))},error:function(e,r){S.error(e+":",r),n.error(e+": "+r)}})}function M(e,n){if(y){var o=T[e];if(o&&o.webrtcStuff){var a={janus:"trickle",candidate:n,transaction:S.randomString(12)};if(o.token&&(a.token=o.token),m&&(a.apisecret=m),S.vdebug("Sending trickle candidate (handle="+e+"):"),S.vdebug(a),r)return a.session_id=k,a.handle_id=e,void t.send(JSON.stringify(a));S.httpAPICall(s+"/"+k+"/"+e,{verb:"POST",withCredentials:f,body:a,success:function(e){S.vdebug("Candidate sent!"),S.vdebug(e),"ack"===e.janus||S.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,r){S.error(e+":",r)}})}else S.warn("Invalid handle")}else S.warn("Is the server down? (connected=false)")}function P(e,r,t,n,o){var a=T[e];if(a&&a.webrtcStuff){var i=a.webrtcStuff,s=function(e){S.log("Received state change on data channel:",e);var r=e.target.label,t=e.target.protocol,n=i.dataChannel[r]?i.dataChannel[r].readyState:"null";if(S.log("State change on <"+r+"> data channel: "+n),"open"===n){if(i.dataChannel[r].pending&&i.dataChannel[r].pending.length>0){S.log("Sending pending messages on <"+r+">:",i.dataChannel[r].pending.length);var o,s=Object(p.a)(i.dataChannel[r].pending);try{for(s.s();!(o=s.n()).done;){var d=o.value;S.log("Sending data on data channel <"+r+">"),S.debug(d),i.dataChannel[r].send(d)}}catch(c){s.e(c)}finally{s.f()}i.dataChannel[r].pending=[]}a.ondataopen(r,t)}};if(n)i.dataChannel[r]=n;else{var d={ordered:!0};t&&(d.protocol=t),i.dataChannel[r]=i.pc.createDataChannel(r,d)}i.dataChannel[r].onmessage=function(e){S.log("Received message on data channel:",e);var r=e.target.label;a.ondata(e.data,r)},i.dataChannel[r].onopen=s,i.dataChannel[r].onclose=s,i.dataChannel[r].onerror=function(e){S.error("Got error on data channel:",e)},i.dataChannel[r].pending=[],o&&i.dataChannel[r].pending.push(o)}else S.warn("Invalid handle")}function E(e,r){(r=r||{}).success="function"==typeof r.success?r.success:S.noop,r.error="function"==typeof r.error?r.error:S.noop;var t=T[e];if(!t||!t.webrtcStuff)return S.warn("Invalid handle"),void r.error("Invalid handle");var n=t.webrtcStuff,o=r.text||r.data;if(!o)return S.warn("Invalid data"),void r.error("Invalid data");var a=r.label?r.label:S.dataChanDefaultLabel;return n.dataChannel[a]?"open"!==n.dataChannel[a].readyState?(n.dataChannel[a].pending.push(o),void r.success()):(S.log("Sending data on data channel <"+a+">"),S.debug(o),n.dataChannel[a].send(o),void r.success()):(P(e,a,r.protocol,!1,o,r.protocol),void r.success())}function x(e,r){(r=r||{}).success="function"==typeof r.success?r.success:S.noop,r.error="function"==typeof r.error?r.error:S.noop;var t=T[e];if(!t||!t.webrtcStuff)return S.warn("Invalid handle"),void r.error("Invalid handle");var n=t.webrtcStuff;if(!n.dtmfSender){if(n.pc){var o=n.pc.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));if(!o)return S.warn("Invalid DTMF configuration (no audio track)"),void r.error("Invalid DTMF configuration (no audio track)");n.dtmfSender=o.dtmf,n.dtmfSender&&(S.log("Created DTMF Sender"),n.dtmfSender.ontonechange=function(e){S.debug("Sent DTMF tone: "+e.tone)})}if(!n.dtmfSender)return S.warn("Invalid DTMF configuration"),void r.error("Invalid DTMF configuration")}var a=r.dtmf;if(!a)return S.warn("Invalid DTMF parameters"),void r.error("Invalid DTMF parameters");var i=a.tones;if(!i)return S.warn("Invalid DTMF string"),void r.error("Invalid DTMF string");var s="number"===typeof a.duration?a.duration:500,d="number"===typeof a.gap?a.gap:50;S.debug("Sending DTMF string "+i+" (duration "+s+"ms, gap "+d+"ms)"),n.dtmfSender.insertDTMF(i,s,d),r.success()}function L(e,n){(n=n||{}).success="function"==typeof n.success?n.success:S.noop,n.error="function"==typeof n.error?n.error:S.noop;var o=!0===n.noRequest;S.log("Destroying handle "+e+" (only-locally="+o+")"),G(e);var a=T[e];if(!a||a.detached)return delete T[e],void n.success();if(o)return delete T[e],void n.success();if(!y)return S.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var i={janus:"detach",transaction:S.randomString(12)};if(a.token&&(i.token=a.token),m&&(i.apisecret=m),r)return i.session_id=k,i.handle_id=e,t.send(JSON.stringify(i)),delete T[e],void n.success();S.httpAPICall(s+"/"+k+"/"+e,{verb:"POST",withCredentials:f,body:i,success:function(r){S.log("Destroyed handle:"),S.debug(r),"success"!==r.janus&&S.error("Ooops: "+r.error.code+" "+r.error.reason),delete T[e],n.success()},error:function(r,t){S.error(r+":",t),delete T[e],n.success()}})}function F(e,r,t,n,o){var a=T[e];if(!a||!a.webrtcStuff)return S.warn("Invalid handle"),n.stream||S.stopAllTracks(o),void n.error("Invalid handle");var i=a.webrtcStuff;S.debug("streamsDone:",o),o&&(S.debug("  -- Audio tracks:",o.getAudioTracks()),S.debug("  -- Video tracks:",o.getVideoTracks()));var s=!1;if(i.myStream&&t.update&&!i.streamExternal){if((!t.update&&z(t)||t.update&&(t.addAudio||t.replaceAudio))&&o.getAudioTracks()&&o.getAudioTracks().length)if(i.myStream.addTrack(o.getAudioTracks()[0]),S.unifiedPlan){S.log((t.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]);var f=null,v=i.pc.getTransceivers();if(v&&v.length>0){var g,m=Object(p.a)(v);try{for(m.s();!(g=m.n()).done;){var h=g.value;if(h.sender&&h.sender.track&&"audio"===h.sender.track.kind||h.receiver&&h.receiver.track&&"audio"===h.receiver.track.kind){f=h;break}}}catch(j){m.e(j)}finally{m.f()}}f&&f.sender?f.sender.replaceTrack(o.getAudioTracks()[0]):i.pc.addTrack(o.getAudioTracks()[0],o)}else S.log((t.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]),i.pc.addTrack(o.getAudioTracks()[0],o);if((!t.update&&Y(t)||t.update&&(t.addVideo||t.replaceVideo))&&o.getVideoTracks()&&o.getVideoTracks().length)if(i.myStream.addTrack(o.getVideoTracks()[0]),S.unifiedPlan){S.log((t.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]);var b=null,y=i.pc.getTransceivers();if(y&&y.length>0){var k,A=Object(p.a)(y);try{for(A.s();!(k=A.n()).done;){var C=k.value;if(C.sender&&C.sender.track&&"video"===C.sender.track.kind||C.receiver&&C.receiver.track&&"video"===C.receiver.track.kind){b=C;break}}}catch(j){A.e(j)}finally{A.f()}}b&&b.sender?b.sender.replaceTrack(o.getVideoTracks()[0]):i.pc.addTrack(o.getVideoTracks()[0],o)}else S.log((t.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]),i.pc.addTrack(o.getVideoTracks()[0],o)}else i.myStream=o,s=!0;if(!i.pc){var D={iceServers:d,iceTransportPolicy:c,bundlePolicy:l};"chrome"===S.webRTCAdapter.browserDetails.browser&&(D.sdpSemantics=S.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var R={optional:[{DtlsSrtpKeyAgreement:!0}]};if(u&&R.optional.push({googIPv6:!0}),n.rtcConstraints&&"object"===typeof n.rtcConstraints)for(var I in S.debug("Adding custom PeerConnection constraints:",n.rtcConstraints),n.rtcConstraints)R.optional.push(n.rtcConstraints[I]);"edge"===S.webRTCAdapter.browserDetails.browser&&(D.bundlePolicy="max-bundle"),RTCRtpSender&&RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams&&(n.senderTransforms||n.receiverTransforms)&&(i.senderTransforms=n.senderTransforms,i.receiverTransforms=n.receiverTransforms,D.forceEncodedAudioInsertableStreams=!0,D.forceEncodedVideoInsertableStreams=!0,D.encodedInsertableStreams=!0),S.log("Creating PeerConnection"),S.debug(R),i.pc=new RTCPeerConnection(D,R),S.debug(i.pc),i.pc.getStats&&(i.volume={},i.bitrate.value="0 kbits/sec"),S.log("Preparing local SDP and gathering candidates (trickle="+i.trickle+")"),i.pc.oniceconnectionstatechange=function(e){i.pc&&a.iceState(i.pc.iceConnectionState)},i.pc.onicecandidate=function(r){if(!r.candidate||"edge"===S.webRTCAdapter.browserDetails.browser&&r.candidate.candidate.indexOf("endOfCandidates")>0)S.log("End of candidates."),i.iceDone=!0,!0===i.trickle?M(e,{completed:!0}):function(e,r){(r=r||{}).success="function"==typeof r.success?r.success:S.noop,r.error="function"==typeof r.error?r.error:S.noop;var t=T[e];if(!t||!t.webrtcStuff)return void S.warn("Invalid handle, not sending anything");var n=t.webrtcStuff;if(S.log("Sending offer/answer SDP..."),!n.mySdp)return void S.warn("Local SDP instance is invalid, not sending anything...");n.mySdp={type:n.pc.localDescription.type,sdp:n.pc.localDescription.sdp},!1===n.trickle&&(n.mySdp.trickle=!1);S.debug(r),n.sdpSent=!0,r.success(n.mySdp)}(e,n);else{var t={candidate:r.candidate.candidate,sdpMid:r.candidate.sdpMid,sdpMLineIndex:r.candidate.sdpMLineIndex};!0===i.trickle&&M(e,t)}},i.pc.ontrack=function(e){if(S.log("Handling Remote Track"),S.debug(e),e.streams&&(i.remoteStream=e.streams[0],a.onremotestream(i.remoteStream),!e.track.onended)){if(i.receiverTransforms){var r=null;"audio"===e.track.kind&&i.receiverTransforms.audio?r=e.receiver.createEncodedAudioStreams():"video"===e.track.kind&&i.receiverTransforms.video&&(r=e.receiver.createEncodedVideoStreams()),r&&r.readableStream.pipeThrough(i.receiverTransforms[e.track.kind]).pipeTo(r.writableStream)}var t=null;S.log("Adding onended callback to track:",e.track),e.track.onended=function(e){S.log("Remote track removed:",e),i.remoteStream&&(clearTimeout(t),i.remoteStream.removeTrack(e.target),a.onremotestream(i.remoteStream))},e.track.onmute=function(e){S.log("Remote track muted:",e),i.remoteStream&&null==t&&(t=setTimeout((function(){S.log("Removing remote track"),i.remoteStream&&(i.remoteStream.removeTrack(e.target),a.onremotestream(i.remoteStream)),t=null}),2520))},e.track.onunmute=function(e){if(S.log("Remote track flowing again:",e),null!=t)clearTimeout(t),t=null;else try{i.remoteStream.addTrack(e.target),a.onremotestream(i.remoteStream)}catch(r){S.error(r)}}}}}if(s&&o){S.log("Adding local stream");var O=!0===n.simulcast2;o.getTracks().forEach((function(e){if(S.log("Adding local track:",e),O)if("audio"===e.kind)i.pc.addTrack(e,o);else{S.log("Enabling rid-based simulcasting:",e);var r=w(n.simulcastMaxBitrates);i.pc.addTransceiver(e,{direction:"sendrecv",streams:[o],sendEncodings:[{rid:"h",active:!0,maxBitrate:r.high},{rid:"m",active:!0,maxBitrate:r.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:r.low,scaleResolutionDownBy:4}]})}else{var t=i.pc.addTrack(e,o);if(t&&i.senderTransforms){var a=null;"audio"===t.track.kind&&i.senderTransforms.audio?a=t.createEncodedAudioStreams():"video"===t.track.kind&&i.senderTransforms.video&&(a=t.createEncodedVideoStreams()),a&&a.readableStream.pipeThrough(i.senderTransforms[t.track.kind]).pipeTo(a.writableStream)}}}))}(function(e){if(S.debug("isDataEnabled:",e),"edge"===S.webRTCAdapter.browserDetails.browser)return S.warn("Edge doesn't support data channels yet"),!1;return void 0!==e&&null!==e&&!0===e.data})(t)&&!i.dataChannel[S.dataChanDefaultLabel]&&(S.log("Creating default data channel"),P(e,S.dataChanDefaultLabel,null,!1),i.pc.ondatachannel=function(r){S.log("Data channel created by Janus:",r),P(e,r.channel.label,r.channel.protocol,r.channel)}),i.myStream&&a.onlocalstream(i.myStream),r?i.pc.setRemoteDescription(r).then((function(){if(S.log("Remote description accepted!"),i.remoteSdp=r.sdp,i.candidates&&i.candidates.length>0){for(var o=0;o<i.candidates.length;o++){var a=i.candidates[o];S.debug("Adding remote candidate:",a),a&&!0!==a.completed?i.pc.addIceCandidate(a):i.pc.addIceCandidate(S.endOfCandidates)}i.candidates=[]}!function(e,r,t){(t=t||{}).success="function"==typeof t.success?t.success:S.noop,t.error="function"==typeof t.error?t.error:S.noop,t.customizeSdp="function"==typeof t.customizeSdp?t.customizeSdp:S.noop;var n=T[e];if(!n||!n.webrtcStuff)return S.warn("Invalid handle"),void t.error("Invalid handle");var o=n.webrtcStuff,a=!0===t.simulcast;a?S.log("Creating answer (iceDone="+o.iceDone+", simulcast="+a+")"):S.log("Creating answer (iceDone="+o.iceDone+")");var i=null;if(S.unifiedPlan){i={};var s=null,d=null,c=o.pc.getTransceivers();if(c&&c.length>0){var l,u=Object(p.a)(c);try{for(u.s();!(l=u.n()).done;){var f=l.value;f.sender&&f.sender.track&&"audio"===f.sender.track.kind||f.receiver&&f.receiver.track&&"audio"===f.receiver.track.kind?s||(s=f):(f.sender&&f.sender.track&&"video"===f.sender.track.kind||f.receiver&&f.receiver.track&&"video"===f.receiver.track.kind)&&(d||(d=f))}}catch(j){u.e(j)}finally{u.f()}}var v=z(r),g=H(r);if(v||g){if(v&&g){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",S.log("Setting audio transceiver to sendrecv:",s)}catch(C){S.error(C)}}else if(v&&!g)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",S.log("Setting audio transceiver to sendonly:",s))}catch(C){S.error(C)}else if(!v&&g)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",S.log("Setting audio transceiver to recvonly:",s)}catch(C){S.error(C)}else s=o.pc.addTransceiver("audio",{direction:"recvonly"}),S.log("Adding recvonly audio transceiver:",s)}else if(r.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",S.log("Setting audio transceiver to inactive:",s)}catch(C){S.error(C)}var m=Y(r),h=K(r);if(m||h){if(m&&h){if(d)try{d.setDirection?d.setDirection("sendrecv"):d.direction="sendrecv",S.log("Setting video transceiver to sendrecv:",d)}catch(C){S.error(C)}}else if(m&&!h){if(d)try{d.setDirection?d.setDirection("sendonly"):d.direction="sendonly",S.log("Setting video transceiver to sendonly:",d)}catch(C){S.error(C)}}else if(!m&&h)if(d)try{d.setDirection?d.setDirection("recvonly"):d.direction="recvonly",S.log("Setting video transceiver to recvonly:",d)}catch(C){S.error(C)}else d=o.pc.addTransceiver("video",{direction:"recvonly"}),S.log("Adding recvonly video transceiver:",d)}else if(r.removeVideo&&d)try{d.setDirection?d.setDirection("inactive"):d.direction="inactive",S.log("Setting video transceiver to inactive:",d)}catch(C){S.error(C)}}else i="firefox"===S.webRTCAdapter.browserDetails.browser||"edge"===S.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:H(r),offerToReceiveVideo:K(r)}:{mandatory:{OfferToReceiveAudio:H(r),OfferToReceiveVideo:K(r)}};S.debug(i);var b=Y(r);if(b&&a&&"firefox"===S.webRTCAdapter.browserDetails.browser){S.log("Enabling Simulcasting for Firefox (RID)");var y=o.pc.getSenders()[1];S.log(y);var k=y.getParameters();S.log(k);var A=w(t.simulcastMaxBitrates);y.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:A.high},{rid:"medium",active:!0,priority:"medium",maxBitrate:A.medium},{rid:"low",active:!0,priority:"low",maxBitrate:A.low}]})}o.pc.createAnswer(i).then((function(e){S.debug(e);var r={type:e.type,sdp:e.sdp};t.customizeSdp(r),e.sdp=r.sdp,S.log("Setting local description"),b&&a&&("chrome"===S.webRTCAdapter.browserDetails.browser?S.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==S.webRTCAdapter.browserDetails.browser&&S.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=e.sdp,o.pc.setLocalDescription(e).catch(t.error),o.mediaConstraints=i,o.iceDone||o.trickle?((o.senderTransforms||o.receiverTransforms)&&(e.e2ee=!0),t.success(e)):S.log("Waiting for all candidates...")}),t.error)}(e,t,n)}),n.error):function(e,r,t){(t=t||{}).success="function"==typeof t.success?t.success:S.noop,t.error="function"==typeof t.error?t.error:S.noop,t.customizeSdp="function"==typeof t.customizeSdp?t.customizeSdp:S.noop;var n=T[e];if(!n||!n.webrtcStuff)return S.warn("Invalid handle"),void t.error("Invalid handle");var o=n.webrtcStuff,a=!0===t.simulcast;a?S.log("Creating offer (iceDone="+o.iceDone+", simulcast="+a+")"):S.log("Creating offer (iceDone="+o.iceDone+")");var i={};if(S.unifiedPlan){var s=null,d=null,c=o.pc.getTransceivers();if(c&&c.length>0){var l,u=Object(p.a)(c);try{for(u.s();!(l=u.n()).done;){var f=l.value;f.sender&&f.sender.track&&"audio"===f.sender.track.kind||f.receiver&&f.receiver.track&&"audio"===f.receiver.track.kind?s||(s=f):(f.sender&&f.sender.track&&"video"===f.sender.track.kind||f.receiver&&f.receiver.track&&"video"===f.receiver.track.kind)&&(d||(d=f))}}catch(j){u.e(j)}finally{u.f()}}var v=z(r),g=H(r);v||g?v&&g?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",S.log("Setting audio transceiver to sendrecv:",s)):v&&!g?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",S.log("Setting audio transceiver to sendonly:",s)):!v&&g&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",S.log("Setting audio transceiver to recvonly:",s)):(s=o.pc.addTransceiver("audio",{direction:"recvonly"}),S.log("Adding recvonly audio transceiver:",s))):r.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",S.log("Setting audio transceiver to inactive:",s));var m=Y(r),h=K(r);m||h?m&&h?d&&(d.setDirection?d.setDirection("sendrecv"):d.direction="sendrecv",S.log("Setting video transceiver to sendrecv:",d)):m&&!h?d&&(d.setDirection?d.setDirection("sendonly"):d.direction="sendonly",S.log("Setting video transceiver to sendonly:",d)):!m&&h&&(d?(d.setDirection?d.setDirection("recvonly"):d.direction="recvonly",S.log("Setting video transceiver to recvonly:",d)):(d=o.pc.addTransceiver("video",{direction:"recvonly"}),S.log("Adding recvonly video transceiver:",d))):r.removeVideo&&d&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive",S.log("Setting video transceiver to inactive:",d))}else i.offerToReceiveAudio=H(r),i.offerToReceiveVideo=K(r);!0===t.iceRestart&&(i.iceRestart=!0);S.debug(i);var b=Y(r);if(b&&a&&"firefox"===S.webRTCAdapter.browserDetails.browser){S.log("Enabling Simulcasting for Firefox (RID)");var y=o.pc.getSenders().find((function(e){return"video"===e.track.kind}));if(y){var k=y.getParameters();k||(k={});var A=w(t.simulcastMaxBitrates);k.encodings=[{rid:"h",active:!0,maxBitrate:A.high},{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:A.low,scaleResolutionDownBy:4}],y.setParameters(k)}}o.pc.createOffer(i).then((function(e){S.debug(e);var r={type:e.type,sdp:e.sdp};t.customizeSdp(r),e.sdp=r.sdp,S.log("Setting local description"),b&&a&&("chrome"===S.webRTCAdapter.browserDetails.browser||"safari"===S.webRTCAdapter.browserDetails.browser?(S.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){for(var r=e.split("\r\n"),t=!1,n=[-1],o=[-1],a=null,i=null,s=null,d=null,c=-1,l=0;l<r.length;l++){var u=r[l].match(/m=(\w+) */);if(u){if("video"===u[1]){if(!(n[0]<0)){c=l;break}t=!0}else if(n[0]>-1){c=l;break}}else if(t){var f=r[l].match(/a=ssrc-group:FID (\d+) (\d+)/);if(f)n[0]=f[1],o[0]=f[2],r.splice(l,1),l--;else{if(n[0]){var v=r[l].match("a=ssrc:"+n[0]+" cname:(.+)");if(v&&(a=v[1]),(v=r[l].match("a=ssrc:"+n[0]+" msid:(.+)"))&&(i=v[1]),(v=r[l].match("a=ssrc:"+n[0]+" mslabel:(.+)"))&&(s=v[1]),(v=r[l].match("a=ssrc:"+n[0]+" label:(.+)"))&&(d=v[1]),0===r[l].indexOf("a=ssrc:"+o[0])){r.splice(l,1),l--;continue}if(0===r[l].indexOf("a=ssrc:"+n[0])){r.splice(l,1),l--;continue}}0!==r[l].length||(r.splice(l,1),l--)}}}if(n[0]<0){c=-1,t=!1;for(var g=0;g<r.length;g++){var m=r[g].match(/m=(\w+) */);if(m){if("video"===m[1]){if(!(n[0]<0)){c=g;break}t=!0}else if(n[0]>-1){c=g;break}}else if(t){if(n[0]<0){var p=r[g].match(/a=ssrc:(\d+)/);if(p){n[0]=p[1],r.splice(g,1),g--;continue}}else{var h=r[g].match("a=ssrc:"+n[0]+" cname:(.+)");if(h&&(a=h[1]),(h=r[g].match("a=ssrc:"+n[0]+" msid:(.+)"))&&(i=h[1]),(h=r[g].match("a=ssrc:"+n[0]+" mslabel:(.+)"))&&(s=h[1]),(h=r[g].match("a=ssrc:"+n[0]+" label:(.+)"))&&(d=h[1]),0===r[g].indexOf("a=ssrc:"+o[0])){r.splice(g,1),g--;continue}if(0===r[g].indexOf("a=ssrc:"+n[0])){r.splice(g,1),g--;continue}}0!==r[g].length||(r.splice(g,1),g--)}}}if(n[0]<0)return S.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;c<0&&(c=r.length);n[1]=Math.floor(4294967295*Math.random()),n[2]=Math.floor(4294967295*Math.random()),o[1]=Math.floor(4294967295*Math.random()),o[2]=Math.floor(4294967295*Math.random());for(var b=0;b<n.length;b++)a&&(r.splice(c,0,"a=ssrc:"+n[b]+" cname:"+a),c++),i&&(r.splice(c,0,"a=ssrc:"+n[b]+" msid:"+i),c++),s&&(r.splice(c,0,"a=ssrc:"+n[b]+" mslabel:"+s),c++),d&&(r.splice(c,0,"a=ssrc:"+n[b]+" label:"+d),c++),a&&(r.splice(c,0,"a=ssrc:"+o[b]+" cname:"+a),c++),i&&(r.splice(c,0,"a=ssrc:"+o[b]+" msid:"+i),c++),s&&(r.splice(c,0,"a=ssrc:"+o[b]+" mslabel:"+s),c++),d&&(r.splice(c,0,"a=ssrc:"+o[b]+" label:"+d),c++);r.splice(c,0,"a=ssrc-group:FID "+n[2]+" "+o[2]),r.splice(c,0,"a=ssrc-group:FID "+n[1]+" "+o[1]),r.splice(c,0,"a=ssrc-group:FID "+n[0]+" "+o[0]),r.splice(c,0,"a=ssrc-group:SIM "+n[0]+" "+n[1]+" "+n[2]),(e=r.join("\r\n")).endsWith("\r\n")||(e+="\r\n");return e}(e.sdp)):"firefox"!==S.webRTCAdapter.browserDetails.browser&&S.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=e.sdp,o.pc.setLocalDescription(e).catch(t.error),o.mediaConstraints=i,o.iceDone||o.trickle?((o.senderTransforms||o.receiverTransforms)&&(e.e2ee=!0),t.success(e)):S.log("Waiting for all candidates...")}),t.error)}(e,t,n)}function N(e,r,t){(t=t||{}).success="function"==typeof t.success?t.success:S.noop,t.error="function"==typeof t.error?t.error:B;var n=t.jsep;if(r&&n)return S.error("Provided a JSEP to a createOffer"),void t.error("Provided a JSEP to a createOffer");if(!r&&(!n||!n.type||!n.sdp))return S.error("A valid JSEP is required for createAnswer"),void t.error("A valid JSEP is required for createAnswer");t.media="object"===typeof t.media&&t.media?t.media:{audio:!0,video:!0};var o=t.media,a=T[e];if(!a||!a.webrtcStuff)return S.warn("Invalid handle"),void t.error("Invalid handle");var i,s=a.webrtcStuff;if(s.trickle=(i=t.trickle,S.debug("isTrickleEnabled:",i),!1!==i),s.pc){if(S.log("Updating existing media session"),o.update=!0,t.stream)t.stream!==s.myStream&&S.log("Renegotiation involves a new external stream");else{if(o.addAudio){if(o.keepAudio=!1,o.replaceAudio=!1,o.removeAudio=!1,o.audioSend=!0,s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length)return S.error("Can't add audio stream, there already is one"),void t.error("Can't add audio stream, there already is one")}else o.removeAudio?(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!1,o.audioSend=!1):o.replaceAudio&&(o.keepAudio=!1,o.addAudio=!1,o.removeAudio=!1,o.audioSend=!0);if(s.myStream&&s.myStream.getAudioTracks()&&0!==s.myStream.getAudioTracks().length?!z(o)||o.removeAudio||o.replaceAudio||(o.keepAudio=!0):(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),z(o)&&(o.keepAudio=!1,o.addAudio=!0)),o.addVideo){if(o.keepVideo=!1,o.replaceVideo=!1,o.removeVideo=!1,o.videoSend=!0,s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length)return S.error("Can't add video stream, there already is one"),void t.error("Can't add video stream, there already is one")}else o.removeVideo?(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!1,o.videoSend=!1):o.replaceVideo&&(o.keepVideo=!1,o.addVideo=!1,o.removeVideo=!1,o.videoSend=!0);s.myStream&&s.myStream.getVideoTracks()&&0!==s.myStream.getVideoTracks().length?!Y(o)||o.removeVideo||o.replaceVideo||(o.keepVideo=!0):(o.replaceVideo&&(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!0,o.videoSend=!0),Y(o)&&(o.keepVideo=!1,o.addVideo=!0)),o.addData&&(o.data=!0)}if(z(o)&&o.keepAudio&&Y(o)&&o.keepVideo)return a.consentDialog(!1),void F(e,n,o,t,s.myStream)}else o.update=!1,o.keepAudio=!1,o.keepVideo=!1;if(o.update&&!s.streamExternal){if(o.removeAudio||o.replaceAudio){if(s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length){var d=s.myStream.getAudioTracks()[0];S.log("Removing audio track:",d),s.myStream.removeTrack(d);try{d.stop()}catch(E){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var c=!0;if(o.replaceAudio&&S.unifiedPlan&&(c=!1),c){var l,u=Object(p.a)(s.pc.getSenders());try{for(u.s();!(l=u.n()).done;){var f=l.value;f&&f.track&&"audio"===f.track.kind&&(S.log("Removing audio sender:",f),s.pc.removeTrack(f))}}catch(x){u.e(x)}finally{u.f()}}}}if(o.removeVideo||o.replaceVideo){if(s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length){var v=s.myStream.getVideoTracks()[0];S.log("Removing video track:",v),s.myStream.removeTrack(v);try{v.stop()}catch(E){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var g=!0;if(o.replaceVideo&&S.unifiedPlan&&(g=!1),g){var m,h=Object(p.a)(s.pc.getSenders());try{for(h.s();!(m=h.n()).done;){var b=m.value;b&&b.track&&"video"===b.track.kind&&(S.log("Removing video sender:",b),s.pc.removeTrack(b))}}catch(x){h.e(x)}finally{h.f()}}}}}if(t.stream){var w=t.stream;return S.log("MediaStream provided by the application"),S.debug(w),o.update&&s.myStream&&s.myStream!==t.stream&&!s.streamExternal&&(S.stopAllTracks(s.myStream),s.myStream=null),s.streamExternal=!0,a.consentDialog(!1),void F(e,n,o,t,w)}if(z(o)||Y(o)){if(!S.isGetUserMediaAvailable())return void t.error("getUserMedia not available");var y={mandatory:{},optional:[]};a.consentDialog(!0);var k=z(o);k&&o&&"object"===typeof o.audio&&(k=o.audio);var A=Y(o);if(A&&o){var C=!0===t.simulcast,D=!0===t.simulcast2;if(!C&&!D||n||o.video||(o.video="hires"),o.video&&"screen"!==o.video&&"window"!==o.video)if("object"===typeof o.video)A=o.video;else{var R=0,I=0;"lowres"===o.video?(I=240,R=320):"lowres-16:9"===o.video?(I=180,R=320):"hires"===o.video||"hires-16:9"===o.video||"hdres"===o.video?(I=720,R=1280):"fhdres"===o.video?(I=1080,R=1920):"4kres"===o.video?(I=2160,R=3840):"stdres"===o.video?(I=480,R=640):"stdres-16:9"===o.video?(I=360,R=640):(S.log("Default video setting is stdres 4:3"),I=480,R=640),S.log("Adding media constraint:",o.video),A={height:{ideal:I},width:{ideal:R}},S.log("Adding video constraint:",A)}else if("screen"===o.video||"window"===o.video){var O=function(r,i){a.consentDialog(!1),r?t.error(r):F(e,n,o,t,i)},j=function(e,r,t){S.log("Adding media constraint (screen capture)"),S.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){t?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(t){e.addTrack(t.getAudioTracks()[0]),r(null,e)})):r(null,e)})).catch((function(e){a.consentDialog(!1),r(e)}))};if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return y.video={},o.screenshareFrameRate&&(y.video.frameRate=o.screenshareFrameRate),o.screenshareHeight&&(y.video.height=o.screenshareHeight),o.screenshareWidth&&(y.video.width=o.screenshareWidth),y.audio=o.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(y).then((function(r){a.consentDialog(!1),z(o)&&!o.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(a){r.addTrack(a.getAudioTracks()[0]),F(e,n,o,t,r)})):F(e,n,o,t,r)}),(function(e){a.consentDialog(!1),t.error(e)}));if("chrome"===S.webRTCAdapter.browserDetails.browser){var V=S.webRTCAdapter.browserDetails.version,M=33;window.navigator.userAgent.match("Linux")&&(M=35),V>=26&&V<=M?(y={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate,chromeMediaSource:"screen"}},audio:z(o)&&!o.keepAudio},j(y,O)):S.extension.getScreen((function(e,r){if(e)return a.consentDialog(!1),t.error(e);(y={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=r,j(y,O,z(o)&&!o.keepAudio)}))}else if("firefox"===S.webRTCAdapter.browserDetails.browser){if(!(S.webRTCAdapter.browserDetails.version>=33)){var P=new Error("NavigatorUserMediaError");return P.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",a.consentDialog(!1),void t.error(P)}y={video:{mozMediaSource:o.video,mediaSource:o.video},audio:z(o)&&!o.keepAudio},j(y,(function(e,r){if(O(e,r),!e)var t=r.currentTime,n=window.setInterval((function(){r||window.clearInterval(n),r.currentTime===t&&(window.clearInterval(n),r.onended&&r.onended()),t=r.currentTime}),500)}))}return}}o&&"screen"===o.video||navigator.mediaDevices.enumerateDevices().then((function(r){var i=r.some((function(e){return"audioinput"===e.kind})),s=function(e){if(S.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!==typeof e.video||"object"!==typeof e.video.mandatory)return!1;var r=e.video.mandatory;if(r.chromeMediaSource)return"desktop"===r.chromeMediaSource||"screen"===r.chromeMediaSource;if(r.mozMediaSource)return"window"===r.mozMediaSource||"screen"===r.mozMediaSource;if(r.mediaSource)return"window"===r.mediaSource||"screen"===r.mediaSource;return!1}(o)||r.some((function(e){return"videoinput"===e.kind})),d=z(o),c=Y(o),l=function(e){return S.debug("isAudioSendRequired:",e),!!e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}(o),u=function(e){return S.debug("isVideoSendRequired:",e),!!e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}(o);if(d||c||l||u){var f=!!d&&i,v=!!c&&s;if(!f&&!v)return a.consentDialog(!1),t.error("No capture device found"),!1;if(!f&&l)return a.consentDialog(!1),t.error("Audio capture is required, but no capture device found"),!1;if(!v&&u)return a.consentDialog(!1),t.error("Video capture is required, but no capture device found"),!1}var g={audio:!(!i||o.keepAudio)&&k,video:!(!s||o.keepVideo)&&A};S.debug("getUserMedia constraints",g),g.audio||g.video?navigator.mediaDevices.getUserMedia(g).then((function(r){a.consentDialog(!1),F(e,n,o,t,r)})).catch((function(e){a.consentDialog(!1),t.error({code:e.code,name:e.name,message:e.message})})):(a.consentDialog(!1),F(e,n,o,t,w))})).catch((function(e){a.consentDialog(!1),t.error(e)}))}else F(e,n,o,t)}function J(e,r){(r=r||{}).success="function"==typeof r.success?r.success:S.noop,r.error="function"==typeof r.error?r.error:B;var t=r.jsep,n=T[e];if(!n||!n.webrtcStuff)return S.warn("Invalid handle"),void r.error("Invalid handle");var o=n.webrtcStuff;if(t){if(!o.pc)return S.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void r.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");o.pc.setRemoteDescription(t).then((function(){if(S.log("Remote description accepted!"),o.remoteSdp=t.sdp,o.candidates&&o.candidates.length>0){for(var e=0;e<o.candidates.length;e++){var n=o.candidates[e];S.debug("Adding remote candidate:",n),n&&!0!==n.completed?o.pc.addIceCandidate(n):o.pc.addIceCandidate(S.endOfCandidates)}o.candidates=[]}r.success()}),r.error)}else r.error("Invalid JSEP")}function U(e,r){var t=T[e];if(!t||!t.webrtcStuff)return S.warn("Invalid handle"),0;var n=r?"remote":"local",o=t.webrtcStuff;return o.volume[n]||(o.volume[n]={value:0}),!o.pc.getStats||"chrome"!==S.webRTCAdapter.browserDetails.browser&&"safari"!==S.webRTCAdapter.browserDetails.browser?(S.warn("Getting the "+n+" volume unsupported by browser"),0):r&&!o.remoteStream?(S.warn("Remote stream unavailable"),0):r||o.myStream?o.volume[n].timer?o.volume[n].value:(S.log("Starting "+n+" volume monitor"),o.volume[n].timer=setInterval((function(){o.pc.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(r&&!e.remoteSource||!r&&"media-source"!==e.type||(o.volume[n].value=e.audioLevel?e.audioLevel:0))}))}))}),200),0):(S.warn("Local stream unavailable"),0)}function _(e,r){var t=T[e];if(!t||!t.webrtcStuff)return S.warn("Invalid handle"),!0;var n=t.webrtcStuff;return n.pc?n.myStream?r?n.myStream.getVideoTracks()&&0!==n.myStream.getVideoTracks().length?!n.myStream.getVideoTracks()[0].enabled:(S.warn("No video track"),!0):n.myStream.getAudioTracks()&&0!==n.myStream.getAudioTracks().length?!n.myStream.getAudioTracks()[0].enabled:(S.warn("No audio track"),!0):(S.warn("Invalid local MediaStream"),!0):(S.warn("Invalid PeerConnection"),!0)}function W(e,r,t){var n=T[e];if(!n||!n.webrtcStuff)return S.warn("Invalid handle"),!1;var o=n.webrtcStuff;return o.pc?o.myStream?r?o.myStream.getVideoTracks()&&0!==o.myStream.getVideoTracks().length?(o.myStream.getVideoTracks()[0].enabled=!t,!0):(S.warn("No video track"),!1):o.myStream.getAudioTracks()&&0!==o.myStream.getAudioTracks().length?(o.myStream.getAudioTracks()[0].enabled=!t,!0):(S.warn("No audio track"),!1):(S.warn("Invalid local MediaStream"),!1):(S.warn("Invalid PeerConnection"),!1)}function q(e){var r=T[e];if(!r||!r.webrtcStuff)return S.warn("Invalid handle"),"Invalid handle";var t=r.webrtcStuff;return t.pc?t.pc.getStats?t.bitrate.timer?t.bitrate.value:(S.log("Starting bitrate timer (via getStats)"),t.bitrate.timer=setInterval((function(){t.pc.getStats().then((function(e){e.forEach((function(e){if(e){var r=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?r=!0:"ssrc"!==e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(r=!0),r)if(t.bitrate.bsnow=e.bytesReceived,t.bitrate.tsnow=e.timestamp,null===t.bitrate.bsbefore||null===t.bitrate.tsbefore)t.bitrate.bsbefore=t.bitrate.bsnow,t.bitrate.tsbefore=t.bitrate.tsnow;else{var n=t.bitrate.tsnow-t.bitrate.tsbefore;"safari"===S.webRTCAdapter.browserDetails.browser&&(n/=1e3);var o=Math.round(8*(t.bitrate.bsnow-t.bitrate.bsbefore)/n);"safari"===S.webRTCAdapter.browserDetails.browser&&(o=parseInt(o/1e3)),t.bitrate.value=o+" kbits/sec",t.bitrate.bsbefore=t.bitrate.bsnow,t.bitrate.tsbefore=t.bitrate.tsnow}}}))}))}),1e3),"0 kbits/sec"):(S.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function B(e){S.error("WebRTC error:",e)}function G(e,n){S.log("Cleaning WebRTC stuff");var o=T[e];if(o){var a=o.webrtcStuff;if(a){if(!0===n){var i={janus:"hangup",transaction:S.randomString(12)};o.token&&(i.token=o.token),m&&(i.apisecret=m),S.debug("Sending hangup request (handle="+e+"):"),S.debug(i),r?(i.session_id=k,i.handle_id=e,t.send(JSON.stringify(i))):S.httpAPICall(s+"/"+k+"/"+e,{verb:"POST",withCredentials:f,body:i})}a.remoteStream=null,a.volume&&(a.volume.local&&a.volume.local.timer&&clearInterval(a.volume.local.timer),a.volume.remote&&a.volume.remote.timer&&clearInterval(a.volume.remote.timer)),a.volume={},a.bitrate.timer&&clearInterval(a.bitrate.timer),a.bitrate.timer=null,a.bitrate.bsnow=null,a.bitrate.bsbefore=null,a.bitrate.tsnow=null,a.bitrate.tsbefore=null,a.bitrate.value=null,!a.streamExternal&&a.myStream&&(S.log("Stopping local stream tracks"),S.stopAllTracks(a.myStream)),a.streamExternal=!1,a.myStream=null;try{a.pc.close()}catch(d){}a.pc=null,a.candidates=null,a.mySdp=null,a.remoteSdp=null,a.iceDone=!1,a.dataChannel={},a.dtmfSender=null,a.senderTransforms=null,a.receiverTransforms=null}o.oncleanup()}}function z(e){return S.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function H(e){return S.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function Y(e){return S.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function K(e){return S.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}j(e),this.getServer=function(){return s},this.isConnected=function(){return y},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:S.noop,e.error="function"==typeof e.error?e.error:S.noop,e.reconnect=!0,j(e)},this.getSessionId=function(){return k},this.destroy=function(a){!function(a){(a=a||{}).success="function"==typeof a.success?a.success:S.noop,a.error="function"==typeof a.error?a.error:S.noop;var i=!0===a.unload,d=!0;void 0!==a.notifyDestroyed&&null!==a.notifyDestroyed&&(d=!0===a.notifyDestroyed);var c=!0===a.cleanupHandles;if(S.log("Destroying session "+k+" (unload="+i+")"),!k)return S.warn("No session to destroy"),a.success(),void(d&&e.destroyed());if(c)for(var l in T)L(l,{noRequest:!0});if(!y)return S.warn("Is the server down? (connected=false)"),k=null,void a.success();var u={janus:"destroy",transaction:S.randomString(12)};g&&(u.token=g);m&&(u.apisecret=m);if(i)return r?(t.onclose=null,t.close(),t=null):navigator.sendBeacon(s+"/"+k,JSON.stringify(u)),S.log("Destroyed session:"),k=null,y=!1,a.success(),void(d&&e.destroyed());if(r){u.session_id=k;var v=function(){for(var e in n)t.removeEventListener(e,n[e]);t.removeEventListener("message",p),t.removeEventListener("error",h),o&&clearTimeout(o),t.close()},p=function(r){var t=JSON.parse(r.data);t.session_id===u.session_id&&t.transaction===u.transaction&&(v(),a.success(),d&&e.destroyed())},h=function(r){v(),a.error("Failed to destroy the server: Is the server down?"),d&&e.destroyed()};return t.addEventListener("message",p),t.addEventListener("error",h),void t.send(JSON.stringify(u))}S.httpAPICall(s+"/"+k,{verb:"POST",withCredentials:f,body:u,success:function(r){S.log("Destroyed session:"),S.debug(r),k=null,y=!1,"success"!==r.janus&&S.error("Ooops: "+r.error.code+" "+r.error.reason),a.success(),d&&e.destroyed()},error:function(r,t){S.error(r+":",t),k=null,y=!1,a.success(),d&&e.destroyed()}})}(a)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:S.noop,e.error="function"==typeof e.error?e.error:S.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:S.noop,e.iceState="function"==typeof e.iceState?e.iceState:S.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:S.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:S.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:S.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:S.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:S.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:S.noop,e.ondata="function"==typeof e.ondata?e.ondata:S.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:S.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:S.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:S.noop,!y)return S.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=e.plugin;if(!n)return S.error("Invalid plugin"),void e.error("Invalid plugin");var o=e.opaqueId,a=e.token?e.token:g,i=S.randomString(12),d={janus:"attach",plugin:n,opaque_id:o,transaction:i};a&&(d.token=a);m&&(d.apisecret=m);if(r)return D[i]=function(r){if(S.debug(r),"success"!==r.janus)return S.error("Ooops: "+r.error.code+" "+r.error.reason),void e.error("Ooops: "+r.error.code+" "+r.error.reason);var t=r.data.id;S.log("Created handle: "+t);var o={session:A,plugin:n,id:t,token:a,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return t},getPlugin:function(){return n},getVolume:function(){return U(t,!0)},getRemoteVolume:function(){return U(t,!0)},getLocalVolume:function(){return U(t,!1)},isAudioMuted:function(){return _(t,!1)},muteAudio:function(){return W(t,!1,!0)},unmuteAudio:function(){return W(t,!1,!1)},isVideoMuted:function(){return _(t,!0)},muteVideo:function(){return W(t,!0,!0)},unmuteVideo:function(){return W(t,!0,!1)},getBitrate:function(){return q(t)},send:function(e){V(t,e)},data:function(e){E(t,e)},dtmf:function(e){x(t,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){N(t,!0,e)},createAnswer:function(e){N(t,!1,e)},handleRemoteJsep:function(e){J(t,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){G(t,!0===e)},detach:function(e){L(t,e)}};T[t]=o,e.success(o)},d.session_id=k,void t.send(JSON.stringify(d));S.httpAPICall(s+"/"+k,{verb:"POST",withCredentials:f,body:d,success:function(r){if(S.debug(r),"success"!==r.janus)return S.error("Ooops: "+r.error.code+" "+r.error.reason),void e.error("Ooops: "+r.error.code+" "+r.error.reason);var t=r.data.id;S.log("Created handle: "+t);var o={session:A,plugin:n,id:t,token:a,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return t},getPlugin:function(){return n},getVolume:function(){return U(t,!0)},getRemoteVolume:function(){return U(t,!0)},getLocalVolume:function(){return U(t,!1)},isAudioMuted:function(){return _(t,!1)},muteAudio:function(){return W(t,!1,!0)},unmuteAudio:function(){return W(t,!1,!1)},isVideoMuted:function(){return _(t,!0)},muteVideo:function(){return W(t,!0,!0)},unmuteVideo:function(){return W(t,!0,!1)},getBitrate:function(){return q(t)},send:function(e){V(t,e)},data:function(e){E(t,e)},dtmf:function(e){x(t,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){N(t,!0,e)},createAnswer:function(e){N(t,!1,e)},handleRemoteJsep:function(e){J(t,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){G(t,!0===e)},detach:function(e){L(t,e)}};T[t]=o,e.success(o)},error:function(r,t){S.error(r+":",t),""===t?e.error(r+": Is the server down?"):e.error(r+": "+t)}})}(e)}}S.useDefaultDependencies=function(e){var r=e&&e.fetch||fetch,t=e&&e.Promise||Promise,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,r){return new n(e,r)},extension:e&&e.extension||b,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||h.a,httpAPICall:function(e,n){var o={method:n.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===n.verb&&(o.headers["Content-Type"]="application/json"),void 0!==n.withCredentials&&(o.credentials=!0===n.withCredentials?"include":n.withCredentials?n.withCredentials:"omit"),n.body&&(o.body=JSON.stringify(n.body));var a=r(e,o).catch((function(e){return t.reject({message:"Probably a network error, is the server down?",error:e})}));if(n.timeout){var i=new t((function(e,r){var t=setTimeout((function(){return clearTimeout(t),r({message:"Request timed out",timeout:n.timeout})}),n.timeout)}));a=t.race([a,i])}return a.then((function(e){return e.ok?typeof n.success===typeof S.noop?e.json().then((function(e){n.success(e)})).catch((function(r){return t.reject({message:"Failed to parse response body",error:r,response:e})})):void 0:t.reject({message:"API call failed",response:e})})).catch((function(e){typeof n.error===typeof S.noop&&n.error(e.message||"<< internal error >>",e)})),a}}},S.noop=function(){},S.dataChanDefaultLabel="JanusDataChannel",S.endOfCandidates=null,S.stopAllTracks=function(e){try{var r,t=e.getTracks(),n=Object(p.a)(t);try{for(n.s();!(r=n.n()).done;){var o=r.value;S.log(o),o&&o.stop()}}catch(a){n.e(a)}finally{n.f()}}catch(i){}},S.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:S.noop,S.initDone)e.callback();else{if(S.trace=S.noop,S.debug=S.noop,S.vdebug=S.noop,S.log=S.noop,S.warn=S.noop,S.error=S.noop,!0===e.debug||"all"===e.debug)S.trace=console.trace.bind(console),S.debug=console.debug.bind(console),S.vdebug=console.debug.bind(console),S.log=console.log.bind(console),S.warn=console.warn.bind(console),S.error=console.error.bind(console);else if(Array.isArray(e.debug)){var r,t=Object(p.a)(e.debug);try{for(t.s();!(r=t.n()).done;){var n=r.value;switch(n){case"trace":S.trace=console.trace.bind(console);break;case"debug":S.debug=console.debug.bind(console);break;case"vdebug":S.vdebug=console.debug.bind(console);break;case"log":S.log=console.log.bind(console);break;case"warn":S.warn=console.warn.bind(console);break;case"error":S.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+n+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}}catch(f){t.e(f)}finally{t.f()}}S.log("Initializing library");var o=e.dependencies||S.useDefaultDependencies();S.isArray=o.isArray,S.webRTCAdapter=o.webRTCAdapter,S.httpAPICall=o.httpAPICall,S.newWebSocket=o.newWebSocket,S.extension=o.extension,S.extension.init(),S.listDevices=function(e,r){e="function"==typeof e?e:S.noop,null==r&&(r={audio:!0,video:!0}),S.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(r).then((function(r){navigator.mediaDevices.enumerateDevices().then((function(t){S.debug(t),e(t),S.stopAllTracks(r)}))})).catch((function(r){S.error(r),e([])})):(S.warn("navigator.mediaDevices unavailable"),e([]))},S.attachMediaStream=function(e,r){try{e.srcObject=r}catch(t){try{e.src=URL.createObjectURL(r)}catch(t){S.error("Error attaching stream to element")}}},S.reattachMediaStream=function(e,r){try{e.srcObject=r.srcObject}catch(t){try{e.src=r.src}catch(t){S.error("Error reattaching stream to element")}}};var a=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",i=window["on"+a];if(window.addEventListener(a,(function(e){for(var r in S.log("Closing window"),S.sessions)S.sessions[r]&&S.sessions[r].destroyOnUnload&&(S.log("Destroying session "+r),S.sessions[r].destroy({unload:!0,notifyDestroyed:!1}));i&&"function"==typeof i&&i()})),S.safariVp8=!1,"safari"===S.webRTCAdapter.browserDetails.browser&&S.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){var s,d=Object(p.a)(RTCRtpSender.getCapabilities("video").codecs);try{for(d.s();!(s=d.n()).done;){var c=s.value;if(c&&c.mimeType&&"video/vp8"===c.mimeType.toLowerCase()){S.safariVp8=!0;break}}}catch(f){d.e(f)}finally{d.f()}S.safariVp8?S.log("This version of Safari supports VP8"):S.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var l=new RTCPeerConnection({});l.createOffer({offerToReceiveVideo:!0}).then((function(e){S.safariVp8=-1!==e.sdp.indexOf("VP8"),S.safariVp8?S.log("This version of Safari supports VP8"):S.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),l.close(),l=null}))}if(S.unifiedPlan=!1,"firefox"===S.webRTCAdapter.browserDetails.browser&&S.webRTCAdapter.browserDetails.version>=59)S.unifiedPlan=!0;else if("chrome"===S.webRTCAdapter.browserDetails.browser&&S.webRTCAdapter.browserDetails.version<72)S.unifiedPlan=!1;else{var u=new RTCPeerConnection;try{u.addTransceiver("audio"),S.unifiedPlan=!0}catch(v){}u.close()}S.initDone=!0,e.callback()}},S.isWebrtcSupported=function(){return!!window.RTCPeerConnection},S.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},S.randomString=function(e){for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",n=0;n<e;n++){var o=Math.floor(Math.random()*r.length);t+=r.substring(o,o+1)}return t};var w,y=S,k="videoroomtest-"+y.randomString(12),T=null,A=!1,C=Math.floor(1e3*Math.random()),D=[];function R(){return c.a.createElement(f.a,{position:"static",id:"top-app-bar"},c.a.createElement(v.a,null,c.a.createElement(g.a,{color:"inherit"},c.a.createElement(m.a,null,"perm_media")),c.a.createElement(g.a,{color:"inherit"},c.a.createElement(m.a,null,"assignment")),c.a.createElement(g.a,{color:"inherit"},c.a.createElement(m.a,null,"today")),c.a.createElement(g.a,{color:"inherit"},c.a.createElement(m.a,null,"description")),c.a.createElement(g.a,{color:"inherit"},c.a.createElement(m.a,null,"settings"))))}y.init({debug:"all",callback:function(){A||(A=!0)}});var I=function(e){Object(i.a)(t,e);var r=Object(s.a)(t);function t(){return Object(o.a)(this,t),r.apply(this,arguments)}return Object(a.a)(t,[{key:"render",value:function(){return c.a.createElement("div",null,c.a.createElement(f.a,{position:"static",id:"bottom-app-bar"},c.a.createElement(v.a,null,c.a.createElement(O,{toggleOn:this.props.toggleAudioMute,toggleOff:this.props.toggleAudioMute,color:"inherit",toggledIcon:"mic_off",regularIcon:"mic"}),c.a.createElement(O,{toggleOn:this.props.toggleVideoMute,toggleOff:this.props.toggleVideoMute,color:"inherit",toggledIcon:"videocam_off",regularIcon:"videocam"}),c.a.createElement(O,{toggleOn:this.toggleScreenShareOn,toggleOff:this.toggleScreenShareOff,color:"inherit",toggledIcon:"screen_share",regularIcon:"stop_screen_share"}))))}}]),t}(c.a.Component),O=function(e){Object(i.a)(t,e);var r=Object(s.a)(t);function t(e){var n;return Object(o.a)(this,t),(n=r.call(this,e)).state={toggled:!1},n}return Object(a.a)(t,[{key:"handleClick",value:function(){this.setState((function(e){return{toggled:!e.toggled}})),this.state.toggled?this.props.toggleOff():this.props.toggleOn()}},{key:"render",value:function(){var e=this,r=this.state.toggled?c.a.createElement(m.a,null,this.props.toggledIcon):c.a.createElement(m.a,null,this.props.regularIcon);return c.a.createElement(g.a,{color:this.props.color,onClick:function(){return e.handleClick()}},r)}}]),t}(c.a.Component),j=function(e){Object(i.a)(t,e);var r=Object(s.a)(t);function t(e){var n;return Object(o.a)(this,t),(n=r.call(this,e)).videoSrc=c.a.createRef(),n}return Object(a.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return this.videoSrc.current&&(this.videoSrc.current.srcObject=this.props.srcObject),c.a.createElement("video",{ref:this.videoSrc,autoPlay:!0,muted:this.props.muted})}}]),t}(c.a.Component),V=function(e){Object(i.a)(t,e);var r=Object(s.a)(t);function t(e){var a;return Object(o.a)(this,t),(a=r.call(this,e)).toggleAudioMute=a.toggleAudioMute.bind(Object(n.a)(a)),a.toggleVideoMute=a.toggleVideoMute.bind(Object(n.a)(a)),a.state={localstream:new MediaStream,info:"Initializing",status:"init",roomID:"",isFront:!0,selfViewSrc:null,selfViewSrcKey:null,remoteList:{},remoteListPluginHandle:{},textRoomConnected:!1,textRoomData:[],textRoomValue:"",publish:!1,speaker:!1,audioMute:!1,videoMute:!1,visible:!1},a}return Object(a.a)(t,[{key:"publishOwnFeed",value:function(e){var r=this;this.state.publish||(this.setState({publish:!0}),T.createOffer({media:{audioRecv:!1,videoRecv:!1,audioSend:e,videoSend:!0},success:function(r){var t={request:"configure",audio:e,video:!0};T.send({message:t,jsep:r})},error:function(t){alert("WebRTC error:",t),e&&r.publishOwnFeed(!1)}}))}},{key:"componentDidMount",value:function(){this.janusStart()}},{key:"janusStart",value:function(){var e=this;this.setState({visible:!0}),w=new y({server:"/janusbase/janus",success:function(){w.attach({plugin:"janus.plugin.videoroom",opaqueId:k,success:function(e){T=e,y.log("Plugin attached! ("+T.getPlugin()+", id="+T.getId()+")"),y.log("  -- This is a publisher/manager");var r={request:"join",room:1234,ptype:"publisher",display:C.toString()};T.send({message:r})},error:function(e){alert("  -- Error attaching plugin...",e)},consentDialog:function(e){},mediaState:function(e,r){},webrtcState:function(e){console.log("Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now")},onmessage:function(r,t){var n=r.videoroom;if(void 0!==n&&null!=n)if("joined"===n){if(e.publishOwnFeed(!0),e.setState({visible:!1}),void 0!==r.publishers&&null!==r.publishers){var o=r.publishers;for(var a in o){var i=o[a].id,s=o[a].display;e.newRemoteFeed(i,s)}}}else if("destroyed"===n);else if("event"===n)if(r.publishers){var d=r.publishers;for(var c in d){var l=d[c].id,u=d[c].display;e.newRemoteFeed(l,u)}}else if(r.leaving){var f=r.leaving,v=parseInt(f);if(e.state.remoteList.hasOwnProperty(v)){console.log("Removing someone");var g=Object.assign({},e.state.remoteList);delete g[v],e.setState({remoteList:g});var m=e.state.remoteListPluginHandle;delete m.numLeaving,e.setState({remoteListPluginHandle:m})}}else if(r.unpublished){if("ok"===r.unpublished)return void T.hangup();var p=parseInt(r.unpublished);if(e.state.remoteList.hasOwnProperty(p)){var h=Object.assign({},e.state.remoteList);delete h[p],e.setState({remoteList:h});var b=e.state.remoteListPluginHandle;delete b.numLeaving,e.setState({remoteListPluginHandle:b})}}else void 0!==r.error&&r.error;void 0!==t&&null!==t&&T.handleRemoteJsep({jsep:t})},onlocalstream:function(r){console.log("Your local stream has arrived:"),console.log(r),e.setState({localstream:r}),e.setState({videoSrc:Math.floor(1e3*Math.random())}),e.setState({status:"ready",info:"Please enter or create room ID"})},onremotestream:function(e){},oncleanup:function(){}})},error:function(e){alert("  Janus Error",e)},destroyed:function(){alert("  Success for End Call "),e.setState({publish:!1})}})}},{key:"switchVideoType",value:function(){T.changeLocalCamera()}},{key:"toggleAudioMute",value:function(){T.isAudioMuted()?(T.unmuteAudio(),this.setState({audioMute:!1})):(T.muteAudio(),this.setState({audioMute:!0}))}},{key:"toggleVideoMute",value:function(){T.isVideoMuted()?(this.setState({videoMute:!1}),T.unmuteVideo()):(this.setState({videoMute:!0}),T.muteVideo())}},{key:"endCall",value:function(){w.destroy()}},{key:"newRemoteFeed",value:function(e,r){var t=this,n=null;w.attach({plugin:"janus.plugin.videoroom",success:function(r){var t={request:"join",room:1234,ptype:"listener",feed:e};(n=r).send({message:t})},error:function(e){alert("  -- Error attaching plugin...",e)},onmessage:function(e,r){e.videoroom;void 0!==r&&null!==r&&n.createAnswer({jsep:r,media:{audioSend:!1,videoSend:!1},success:function(e){var r={request:"start",room:1234};n.send({message:r,jsep:e})},error:function(e){alert("WebRTC error:",e)}})},webrtcState:function(e){},onlocalstream:function(e){},onremotestream:function(r){t.setState({info:"One peer join!"}),console.log("Peer"+e+" stream:"),console.log(r.constructor.name);var o=t.state.remoteList,a=t.state.remoteListPluginHandle;o[e]=r,a[e]=n,t.setState({remoteList:o,remoteListPluginHandle:a})},oncleanup:function(){void 0!==n.spinner&&null!==n.spinner&&n.spinner.stop(),n.spinner=null,null!==D[n.rfindex]&&null!==D[n.rfindex]&&clearInterval(D[n.rfindex]),D[n.rfindex]=null}})}},{key:"render",value:function(){var e=this.state.remoteList,r=Object.keys(e).map((function(r){return c.a.createElement(j,{key:r,srcObject:e[r],muted:!1})}));return c.a.createElement("div",null,c.a.createElement(R,null),c.a.createElement("div",{id:"videoGrid"},c.a.createElement(j,{srcObject:this.state.localstream,muted:!0}),r),c.a.createElement(I,{toggleVideoMute:this.toggleVideoMute,toggleAudioMute:this.toggleAudioMute}))}}]),t}(c.a.Component);function M(){return c.a.createElement("div",null,c.a.createElement(V,null))}u.a.render(c.a.createElement(M,null),document.getElementById("root"))}},[[34,1,2]]]);
//# sourceMappingURL=main.b4b3ac53.chunk.js.map